<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checklist Cards with Modal Title</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body { background-color: #f8f9fa; }
  .card.done { border-left: 6px solid #198754; background-color: #e9f7ef; }
  .item-done { background-color: #e9f7ef; border-left: 4px solid #198754; }
  .qty-input { width: 90px; }
</style>
</head>

<body>
<div class="container py-4">

  <h3 class="text-center mb-4">The Forge</h3>

  <!-- Add Card -->
  <div class="row justify-content-center mb-4">
    <div class="col-md-8">
      <div class="input-group">
        <input type="text" id="cardTitleInput" class="form-control">
        <button class="btn btn-primary" onclick="addCard()">Add Recipe</button>
      </div>
    </div>
  </div>

  <!-- Cards -->
  <div id="cardContainer" class="row g-4 justify-content-center"></div>
</div>

<!-- ITEM & TITLE MODAL -->
<div class="modal fade" id="itemModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Edit Recipe</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <!-- Edit Card Title -->
        <div class="mb-3">
          <label class="form-label">Recipe Name</label>
          <input type="text" id="modalCardTitle" class="form-control">
        </div>

        <!-- Items List -->
        <ul id="modalItemList" class="list-group mb-3"></ul>

        <!-- Add Item -->
        <div class="input-group">
          <input type="text" id="modalItemName" class="form-control" placeholder="Ore">
          <input type="number" id="modalItemQty" class="form-control qty-input" placeholder="Count">
          <button class="btn btn-outline-primary" onclick="addModalItem()">Add</button>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Done</button>
      </div>

    </div>
  </div>
</div>

<script>
const container = document.getElementById("cardContainer");
let activeCard = null;

// Capitalize all words
const capitalizeWords = text =>
  text.replace(/\b\w+/g, w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase());

function saveData() {
  localStorage.setItem("checklistCards", container.innerHTML);
}

function loadData() {
  const data = localStorage.getItem("checklistCards");
  if (data) container.innerHTML = data;
  updateLayout();
}

function updateLayout() {
  const cards = [...container.children];
  if (cards.length === 1) {
    cards[0].className = "col-12 col-md-8";
  } else {
    cards.forEach(c => c.className = "col-12 col-md-6");
  }
}

function addCard() {
  const input = document.getElementById("cardTitleInput");
  if (!input.value.trim()) return;

  const col = document.createElement("div");
  const title = capitalizeWords(input.value.trim());

  col.innerHTML = `
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column">

        <div class="d-flex justify-content-between mb-2">
          <!-- Card title is read-only -->
          <h5 class="card-title">${title}</h5>
          <input type="checkbox" class="form-check-input mt-1" onchange="toggleCardDone(this)">
        </div>

        <!-- Visible item list -->
        <ul class="list-group list-group-flush mb-3"></ul>

        <div class="mt-auto d-flex gap-2">
          <button class="btn btn-sm btn-outline-primary w-100" onclick="openItemModal(this)">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteCard(this)">✕</button>
        </div>

      </div>
    </div>
  `;

  container.appendChild(col);
  input.value = "";
  updateLayout();
  saveData();
}

function openItemModal(btn) {
  activeCard = btn.closest(".card");

  // Load card title into modal input
  document.getElementById("modalCardTitle").value =
    activeCard.querySelector("h5.card-title").textContent;

  // Load items into modal list
  document.getElementById("modalItemList").innerHTML =
    activeCard.querySelector("ul").innerHTML;

  new bootstrap.Modal(document.getElementById("itemModal")).show();
}

function addModalItem() {
  const nameInput = document.getElementById("modalItemName");
  const qtyInput = document.getElementById("modalItemQty");
  if (!nameInput.value.trim()) return;

  const name = capitalizeWords(nameInput.value.trim());

  const li = document.createElement("li");
  li.className = "list-group-item d-flex justify-content-between align-items-center";

  li.innerHTML = `
    <div class="d-flex align-items-center gap-2">
      <input type="checkbox" class="form-check-input" onchange="toggleItemDone(this)">
      <span>${name}</span>
      ${qtyInput.value ? `<span class="badge bg-secondary">x${qtyInput.value}</span>` : ""}
    </div>
    <button class="btn btn-sm btn-outline-danger" onclick="this.closest('li').remove()">✕</button>
  `;

  document.getElementById("modalItemList").appendChild(li);
  nameInput.value = "";
  qtyInput.value = "";
}

document.getElementById("itemModal").addEventListener("hidden.bs.modal", () => {
  if (!activeCard) return;

  // Save card title
  activeCard.querySelector("h5.card-title").textContent =
    capitalizeWords(document.getElementById("modalCardTitle").value.trim());

  // Save items
  activeCard.querySelector("ul").innerHTML =
    document.getElementById("modalItemList").innerHTML;

  saveData();
});

function toggleItemDone(cb) {
  cb.closest("li").classList.toggle("item-done", cb.checked);
}

function toggleCardDone(cb) {
  cb.closest(".card").classList.toggle("done", cb.checked);
  saveData();
}

function deleteCard(btn) {
  if (confirm("Delete this card and all items?")) {
    btn.closest("div[class^='col']").remove();
    updateLayout();
    saveData();
  }
}

loadData();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
